# UAI ONNX Face Parser Library and CLI

This library project provides a **FaceParser** ``ONNXProcessor`` model that can be used to create masks of people in images. The model is based on [Face Parsing](https://huggingface.co/jonathandinu/face-parsing).

![img](https://raw.githubusercontent.com/vltmedia/UAI_ONNX_FaceParse/refs/heads/master/media/demo.png?token=GHSAT0AAAAAACY2FBCLN2JN76255YQK7ZUGZZC2T3A)

# Artifacts Generated

There are multiple artifacts (files) generated by this project.

- Installer for the CLI
- Raw unpackaged CLI directory
  - When built.
- The .dll library to be used along with the [``UAI_ONNX.dll``](https://github.com/vltmedia/UAI_ONNX) file.

# Usage

```bash
UAI_CLI_FaceParse.exe -i input.jpg -o outputDirectory -m model.onnx --saveJson --saveMasks 
```

- Will save the masks in the output directory with the name of the label and the mask id.
- Will save the json file with all the masks as a [MultiMediaItem](https://uai.software/docs/Modules/Common/Interfaces#multimediaitem) and the images encoded as [MediaItem](https://uai.software/docs/Modules/Common/Interfaces#mediaitem) objects with the ``media`` property being a base64 encoded png string.
- Each mask in the .json [MultiMediaItem](https://uai.software/docs/Modules/Common/Interfaces#multimediaitem) will have the mask label as the ``type`` , and ``prompt`` if you need to find the mask by label in your application.

# Requirements

You may need to install the following runtimes to run the library:

- [ASP.NET Core Runtime 8.0.10](https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-aspnetcore-8.0.10-windows-x64-installer)
- [.NET Desktop Runtime 8.0.10](https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-desktop-8.0.10-windows-x64-installer)

# Masks

| id | label      | note              |
| -- | ---------- | ----------------- |
| 0  | background |                   |
| 1  | skin       |                   |
| 2  | nose       |                   |
| 3  | eye_g      | eyeglasses        |
| 4  | l_eye      | left eye          |
| 5  | r_eye      | right eye         |
| 6  | l_brow     | left eyebrow      |
| 7  | r_brow     | right eyebrow     |
| 8  | l_ear      | left ear          |
| 9  | r_ear      | right ear         |
| 10 | mouth      | area between lips |
| 11 | u_lip      | upper lip         |
| 12 | l_lip      | lower lip         |
| 13 | hair       |                   |
| 14 | hat        |                   |
| 15 | ear_r      | earring           |
| 16 | neck_l     | necklace          |
| 17 | neck       |                   |
| 18 | cloth      | clothing          |
